<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft 365 & Google Stack Skills Assessment - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0078d4 0%, #40e0d0 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 120, 212, 0.05) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .header h1 {
            font-size: 2.5em;
            font-weight: 600;
            color: #0078d4;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 1.1em;
            color: #666;
            position: relative;
            z-index: 1;
        }

        .profile-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: #0078d4;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select, textarea {
            padding: 12px 16px;
            border: 2px solid #e1e4e8;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #0078d4;
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
            transform: translateY(-1px);
        }

        .role-alert {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #1976d2;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .role-alert.active {
            display: block;
        }

        .role-alert h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .role-expectations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .expectation-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85em;
            border-left: 3px solid #1976d2;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            overflow-x: auto;
            padding: 5px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 0.9em;
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 120, 212, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .tab:hover::before {
            left: 100%;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab.active {
            background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 120, 212, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .skill-category {
            background: white;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .skill-category:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .category-header {
            background: linear-gradient(135deg, #0078d4 0%, #40e0d0 100%);
            color: white;
            padding: 20px 25px;
            position: relative;
            overflow: hidden;
        }

        .category-header::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .category-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        .category-description {
            font-size: 0.9em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .skill-card {
            padding: 25px;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
            position: relative;
        }

        .skill-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: transparent;
            transition: background 0.3s ease;
        }

        .skill-card:hover {
            background: #f8f9fa;
            padding-left: 30px;
        }

        .skill-card:hover::before {
            background: linear-gradient(180deg, #0078d4 0%, #40e0d0 100%);
        }

        .skill-card:last-child {
            border-bottom: none;
        }

        .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .skill-info {
            flex: 1;
            min-width: 300px;
        }

        .skill-name {
            font-size: 1.15em;
            font-weight: 600;
            color: #0078d4;
            margin-bottom: 8px;
        }

        .skill-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .skill-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .meta-tag {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .cert-tag {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1976d2;
        }

        .required-tag {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            color: #f57c00;
        }

        .expected-level-indicator {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            color: #7b1fa2;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 2px solid #7b1fa2;
        }

        .assessment-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .assessment-block {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .assessment-block:hover {
            border-color: #0078d4;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 120, 212, 0.1);
        }

        .assessment-label {
            font-size: 0.85em;
            font-weight: 600;
            color: #0078d4;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .level-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
        }

        .level-btn {
            width: 36px;
            height: 36px;
            border: 2px solid #e1e4e8;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .level-btn.expected {
            border-color: #7b1fa2;
            background: #f3e5f5;
        }

        .level-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(0, 120, 212, 0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .level-btn:hover {
            border-color: #0078d4;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 120, 212, 0.2);
        }

        .level-btn:hover::before {
            width: 100%;
            height: 100%;
        }

        .level-btn.active {
            background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%);
            color: white;
            border-color: #0078d4;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 120, 212, 0.3);
        }

        .competency-description {
            font-size: 0.8em;
            color: #666;
            background: white;
            padding: 10px;
            border-radius: 8px;
            min-height: 50px;
            border-left: 3px solid #0078d4;
            line-height: 1.4;
        }

        .gap-indicator {
            grid-column: span 2;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .gap-indicator.negative {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border-left-color: #f44336;
        }

        .gap-text {
            font-size: 0.85em;
            font-weight: 600;
            color: #2e7d32;
        }

        .gap-indicator.negative .gap-text {
            color: #c62828;
        }

        .notes-section {
            background: linear-gradient(135deg, #fffde7 0%, #fff9c4 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #fbc02d;
            margin-top: 15px;
        }

        .notes-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .note-block {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .note-label {
            font-size: 0.8em;
            font-weight: 600;
            color: #f57f17;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .note-textarea {
            min-height: 80px;
            resize: vertical;
            font-size: 0.85em;
            border: 2px solid #fff176;
            background: white;
        }

        .note-textarea:focus {
            border-color: #fbc02d;
            box-shadow: 0 0 0 3px rgba(251, 192, 45, 0.2);
        }

        .summary-dashboard {
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border-top: 4px solid #0078d4;
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 120, 212, 0.05) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .metric-value {
            font-size: 2em;
            font-weight: 700;
            color: #0078d4;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        .metric-label {
            font-size: 0.85em;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            position: relative;
            z-index: 1;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9em;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 120, 212, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 120, 212, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #40e0d0 0%, #20b2aa 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(64, 224, 208, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(64, 224, 208, 0.4);
        }

        .analysis-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border-top: 4px solid #0078d4;
        }

        .analysis-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .analysis-icon {
            font-size: 2em;
        }

        .analysis-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #0078d4;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .filter-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e1e4e8;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            border-color: #0078d4;
            background: #f0f8ff;
        }

        .filter-btn.active {
            background: #0078d4;
            color: white;
            border-color: #0078d4;
        }

        @media (max-width: 1024px) {
            .assessment-grid {
                grid-template-columns: 1fr;
            }
            
            .notes-grid {
                grid-template-columns: 1fr;
            }
            
            .skill-header {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .profile-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Microsoft 365 & Google Stack Skills Assessment</h1>
            <p>Comprehensive evaluation for Power Platform, Microsoft 365, Google Cloud, and API development professionals</p>
        </div>

        <div class="profile-section">
            <h3 style="color: #0078d4; margin-bottom: 20px;">Profile Information</h3>
            <div class="profile-grid">
                <div class="form-group">
                    <label>Your Name</label>
                    <input type="text" id="employeeName" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label>Manager Name</label>
                    <input type="text" id="managerName" placeholder="Manager's name">
                </div>
                <div class="form-group">
                    <label>Current Role</label>
                    <select id="currentRole">
                        <option value="">Select your current role</option>
                        <option value="junior-365">Junior 365 Developer</option>
                        <option value="365-developer">365 Stack Developer</option>
                        <option value="senior-365">Senior 365 Developer</option>
                        <option value="365-architect">365 Solutions Architect</option>
                        <option value="technical-lead">Technical Lead</option>
                        <option value="principal-architect">Principal Architect</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <input type="text" id="department" placeholder="e.g., IT, Digital Transformation">
                </div>
                <div class="form-group">
                    <label>Assessment Date</label>
                    <input type="text" id="assessmentDate" readonly>
                </div>
                <div class="form-group">
                    <label>Career Goal</label>
                    <select id="careerGoal">
                        <option value="">Select your target role</option>
                        <option value="senior-365">Senior 365 Developer</option>
                        <option value="365-architect">365 Solutions Architect</option>
                        <option value="technical-lead">Technical Lead</option>
                        <option value="principal-architect">Principal Architect</option>
                    </select>
                </div>
            </div>
            
            <div class="role-alert" id="roleAlert">
                <h4>📋 Expected Competencies for Your Role</h4>
                <div id="roleExpectations" class="role-expectations"></div>
            </div>
        </div>

        <div class="summary-dashboard">
            <h3 style="color: #0078d4; margin-bottom: 20px;">Assessment Summary</h3>
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="metric-value" id="totalSkills">0</div>
                    <div class="metric-label">Skills Assessed</div>
                </div>
                <div class="summary-card">
                    <div class="metric-value" id="avgSelfRating">0.0</div>
                    <div class="metric-label">Avg Self Rating</div>
                </div>
                <div class="summary-card">
                    <div class="metric-value" id="avgManagerRating">0.0</div>
                    <div class="metric-label">Avg Manager Rating</div>
                </div>
                <div class="summary-card">
                    <div class="metric-value" id="developmentAreas">0</div>
                    <div class="metric-label">Development Areas</div>
                </div>
                <div class="summary-card">
                    <div class="metric-value" id="strengths">0</div>
                    <div class="metric-label">Key Strengths</div>
                </div>
                <div class="summary-card">
                    <div class="metric-value" id="readiness">0%</div>
                    <div class="metric-label">Role Readiness</div>
                </div>
            </div>
        </div>

        <div class="filter-section">
            <h4 style="color: #0078d4; margin-bottom: 15px;">Filter Skills</h4>
            <div class="filter-options">
                <button class="filter-btn active" onclick="filterSkills('all')">All Skills</button>
                <button class="filter-btn" onclick="filterSkills('required')">Required for Role</button>
                <button class="filter-btn" onclick="filterSkills('gaps')">Development Areas</button>
                <button class="filter-btn" onclick="filterSkills('strengths')">Strengths</button>
                <button class="filter-btn" onclick="filterSkills('unassessed')">Not Yet Assessed</button>
            </div>
        </div>

        <div class="tabs"></div>

        <div id="analysis-tab" class="tab-content">
            <div class="analysis-section">
                <div class="analysis-header">
                    <span class="analysis-icon">📊</span>
                    <h3 class="analysis-title">Skills Gap Analysis</h3>
                </div>
                <div id="gapAnalysis">Complete your assessment to see detailed gap analysis.</div>
            </div>

            <div class="analysis-section">
                <div class="analysis-header">
                    <span class="analysis-icon">💪</span>
                    <h3 class="analysis-title">Core Strengths</h3>
                </div>
                <div id="strengthsAnalysis">Your key strengths will appear here after assessment.</div>
            </div>

            <div class="analysis-section">
                <div class="analysis-header">
                    <span class="analysis-icon">🎯</span>
                    <h3 class="analysis-title">Development Roadmap</h3>
                </div>
                <div id="developmentRoadmap">Set your career goal to see your personalized development path.</div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="generateDetailedReport()">📄 Generate Full Report</button>
                <button class="btn btn-secondary" onclick="saveAssessment()">💾 Save Assessment</button>
                <button class="btn btn-primary" onclick="exportToPDF()">📑 Export to PDF</button>
                <button class="btn btn-secondary" onclick="loadAssessment()">📂 Load Previous Assessment</button>
            </div>
        </div>
    </div>

    <script>
// Assessment data storage
let assessmentData = {}; // Stores self and manager ratings per skill ID
let skillNotes = {};     // Stores employee and manager notes per skill ID
let currentRole = '';
let careerGoal = '';
let currentFilter = 'all';

// Role expectations
const roleExpectations = {
    'junior-365': [
        'Foundation in Power Apps canvas apps',
        'Basic Power Automate flows',
        'Understanding of Dataverse concepts',
        'SharePoint list integration',
        'Basic troubleshooting skills'
    ],
    '365-developer': [
        'Proficient in canvas and model-driven apps',
        'Complex Power Automate workflows',
        'Dataverse data modeling',
        'Custom connectors development',
        'Basic API integration'
    ],
    'senior-365': [
        'Advanced Power Platform architecture',
        'Performance optimization',
        'Security implementation',
        'API development and integration',
        'Mentoring junior developers'
    ],
    '365-architect': [
        'Enterprise solution architecture',
        'Governance and ALM strategies',
        'Advanced security models',
        'Integration patterns',
        'Technical leadership'
    ],
    'technical-lead': [
        'Team leadership and mentoring',
        'Project planning and execution',
        'Technical decision making',
        'Cross-functional collaboration',
        'Best practices implementation'
    ],
    'principal-architect': [
        'Enterprise strategy definition',
        'Complex solution architecture',
        'Innovation and R&D leadership',
        'Executive stakeholder management',
        'Organization-wide standards'
    ]
};

// Define global functions for inline handlers in skill cards
function updateAssessment(skillId, assessorType, level) {
    if (!assessmentData[skillId]) {
        assessmentData[skillId] = { self: 0, manager: 0 };
    }
    assessmentData[skillId][assessorType] = level;
    
    // Re-render only the specific skill card to update its state and description
    renderSpecificSkillCard(skillId);   
    updateSummary();
    updateAnalysis();
}

function updateNote(skillId, noteType, value) {
    if (!skillNotes[skillId]) {
        skillNotes[skillId] = { employee: '', manager: '' };
    }
    skillNotes[skillId][noteType] = value;
}

function filterSkills(filterType) {
    currentFilter = filterType;
    
    // Update filter button states
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Re-render all skills with the filter applied
    renderAllSkills();
}

// Skills framework - MERGED VERSION including Microsoft 365 and Google Stack
const skillsFramework = {
    'power-apps': {
        title: 'Power Apps Development',
        description: 'Canvas apps, model-driven apps, and component development',
        categories: {
            'Canvas App Development': [
                {
                    id: 'canvas-app-design-ux',
                    skill: 'Canvas App Design & UX',
                    description: 'Create intuitive, responsive canvas applications with excellent user experience',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 5,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    certifications: ['PL-100', 'PL-200'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of canvas apps and simple controls',
                        2: 'Create functional apps with galleries, forms, and basic navigation',
                        3: 'Advanced controls, responsive design, and complex formulas',
                        4: 'Performance optimization, reusable components, and accessibility',
                        5: 'Architect complex enterprise canvas solutions with best practices'
                    }
                },
                {
                    id: 'power-fx-formulas',
                    skill: 'Power Fx Formulas',
                    description: 'Master Power Fx language for complex business logic and data manipulation',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 4
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic formulas and simple calculations',
                        2: 'Collections, variables, and conditional logic',
                        3: 'Complex formulas with delegation awareness',
                        4: 'Advanced patterns, error handling, and performance optimization',
                        5: 'Expert-level formula architecture and custom functions'
                    }
                },
                {
                    id: 'model-driven-apps',
                    skill: 'Model-Driven Apps',
                    description: 'Build data-centric applications with forms, views, and business process flows',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 5,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    certifications: ['PL-200', 'PL-400'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of model-driven concepts',
                        2: 'Create simple apps with standard entities',
                        3: 'Custom entities, relationships, and business rules',
                        4: 'Complex security models and custom UI components',
                        5: 'Enterprise architecture with advanced customizations'
                    }
                }
            ],
            'Advanced Components': [
                {
                    id: 'power-apps-component-framework-pcf',
                    skill: 'Power Apps Component Framework (PCF)',
                    description: 'Build custom components using TypeScript and modern web frameworks',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 4
                    },
                    certifications: ['PL-400'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of PCF concepts',
                        2: 'Simple custom controls with basic functionality',
                        3: 'Complex components with external libraries',
                        4: 'Advanced patterns, performance optimization, and testing',
                        5: 'Architect reusable component libraries'
                    }
                },
                {
                    id: 'custom-pages-canvas-component-library',
                    skill: 'Custom Pages & Canvas Component Library',
                    description: 'Develop custom pages for Model-driven apps and manage reusable canvas components.',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of custom pages and component types.',
                        2: 'Create simple custom pages and basic component libraries.',
                        3: 'Develop complex custom pages with data integration; manage component versions.',
                        4: 'Optimize custom page performance; design advanced component architectures.',
                        5: 'Lead custom page and component library strategy across enterprise solutions.'
                    }
                }
            ]
        }
    },
    'power-automate': {
        title: 'Power Automate',
        description: 'Cloud flows, desktop flows, and business process automation',
        categories: {
            'Cloud Flows': [
                {
                    id: 'cloud-flow-development',
                    skill: 'Cloud Flow Development',
                    description: 'Design and implement automated workflows across cloud services',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 5,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    certifications: ['PL-200', 'PL-400'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic automated flows with standard connectors',
                        2: 'Approval workflows and scheduled flows',
                        3: 'Complex flows with error handling and parallel branches',
                        4: 'Advanced patterns, custom connectors, and performance optimization',
                        5: 'Enterprise automation architecture and governance'
                    }
                },
                {
                    id: 'expression-logic-functions',
                    skill: 'Expression & Logic Functions',
                    description: 'Master Power Automate expressions for data manipulation and complex logic',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 4
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic expressions and simple conditions',
                        2: 'String manipulation and date functions',
                        3: 'Complex expressions with arrays and JSON',
                        4: 'Advanced patterns and custom expressions',
                        5: 'Expert-level expression optimization'
                    }
                }
            ],
            'Desktop Flows (RPA)': [
                {
                    id: 'desktop-flows-rpa',
                    skill: 'Desktop Flows (RPA)',
                    description: 'Robotic Process Automation for legacy systems and desktop applications',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 3,
                        'technical-lead': 3,
                        'principal-architect': 3
                    },
                    certifications: ['PL-500'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic UI recording and simple automation',
                        2: 'Desktop flows with error handling',
                        3: 'Complex RPA scenarios with OCR and AI',
                        4: 'Enterprise RPA deployment and monitoring',
                        5: 'RPA center of excellence leadership'
                    }
                }
            ],
            'Advanced Automation': [
                {
                    id: 'business-process-flows',
                    skill: 'Business Process Flows',
                    description: 'Design guided business processes with stages and conditional branching',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of process flows',
                        2: 'Simple linear process flows',
                        3: 'Complex flows with branching and stages',
                        4: 'Advanced customization with JavaScript',
                        5: 'Enterprise process architecture'
                    }
                },
                {
                    id: 'ai-builder-integration',
                    skill: 'AI Builder Integration',
                    description: 'Integrate AI models (e.g., form processing, object detection) into Power Automate flows.',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['AI-102'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of AI Builder capabilities.',
                        2: 'Use pre-built AI models in simple flows.',
                        3: 'Train custom AI models; integrate with complex data scenarios.',
                        4: 'Optimize AI model performance; troubleshoot AI Builder issues.',
                        5: 'Design and implement advanced AI-driven automation solutions.'
                    }
                }
            ]
        }
    },
    'power-pages': {
        title: 'Power Pages',
        description: 'External-facing websites and portals',
        categories: {
            'Portal Development': [
                {
                    id: 'power-pages-site-design',
                    skill: 'Power Pages Site Design',
                    description: 'Build secure, responsive external-facing websites and portals',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['PL-400'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic portal creation with templates',
                        2: 'Custom pages with authentication',
                        3: 'Advanced customization with Liquid templates',
                        4: 'Complex security models and integrations',
                        5: 'Enterprise portal architecture'
                    }
                },
                {
                    id: 'liquid-templates-web-templates',
                    skill: 'Liquid Templates & Web Templates',
                    description: 'Advanced portal customization using Liquid templating language',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 3,
                        'technical-lead': 3,
                        'principal-architect': 3
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic Liquid syntax understanding',
                        2: 'Simple dynamic content and filters',
                        3: 'Complex templates with FetchXML',
                        4: 'Advanced patterns and performance optimization',
                        5: 'Template architecture and reusability'
                    }
                },
                {
                    id: 'power-pages-security-configuration',
                    skill: 'Power Pages Security Configuration',
                    description: 'Implement robust security measures including web roles, table permissions, and authentication.',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 4,
                        '365-architect': 5,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    certifications: ['PL-600'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of portal security concepts.',
                        2: 'Configure web roles and basic table permissions.',
                        3: 'Implement complex table permissions and content access policies.',
                        4: 'Design custom authentication providers; troubleshoot security issues.',
                        5: 'Architect enterprise-grade security models for Power Pages solutions.'
                    }
                }
            ]
        }
    },
    'dataverse': {
        title: 'Dataverse & Data Management',
        description: 'Data modeling, security, and integration',
        categories: {
            'Data Architecture': [
                {
                    id: 'dataverse-data-modeling',
                    skill: 'Dataverse Data Modeling',
                    description: 'Design efficient data schemas with tables, relationships, and business logic',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 5,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    certifications: ['PL-200', 'PL-400'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of tables and columns',
                        2: 'Create custom tables with relationships',
                        3: 'Complex data models with calculated fields',
                        4: 'Advanced patterns, virtual tables, and optimization',
                        5: 'Enterprise data architecture and governance'
                    }
                },
                {
                    id: 'security-row-level-security',
                    skill: 'Security & Row-Level Security',
                    description: 'Implement comprehensive security models with roles, teams, and field security',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 4,
                        '365-architect': 5,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic security role understanding',
                        2: 'Configure standard security roles',
                        3: 'Complex security with teams and sharing',
                        4: 'Field-level security and hierarchies',
                        5: 'Enterprise security architecture'
                    }
                },
                {
                    id: 'dataverse-search-views',
                    skill: 'Dataverse Search & Views',
                    description: 'Optimize data retrieval with views, filters, and Dataverse search',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic view creation',
                        2: 'Complex views with filters and sorting',
                        3: 'Advanced find and FetchXML',
                        4: 'Performance optimization and indexing',
                        5: 'Search architecture and relevance tuning'
                    }
                }
            ],
            'Data Integration': [
                {
                    id: 'dataflows-data-integration',
                    skill: 'Dataflows & Data Integration',
                    description: 'ETL processes using Power Query and dataflows for data preparation',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic dataflow concepts',
                        2: 'Simple data transformations',
                        3: 'Complex M queries and scheduling',
                        4: 'Advanced patterns and error handling',
                        5: 'Enterprise data pipeline architecture'
                    }
                },
                {
                    id: 'azure-data-integration',
                    skill: 'Azure Data Integration (e.g., Azure Data Factory)',
                    description: 'Integrate Dataverse with external data sources using Azure data services.',
                    requirements: {
                        '365-developer': 1,
                        'senior-365': 2,
                        '365-architect': 3,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['DP-203'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of Azure data services.',
                        2: 'Create simple data pipelines for import/export.',
                        3: 'Design and implement complex data integration solutions with ADF.',
                        4: 'Optimize data pipelines for performance and cost.',
                        5: 'Architect hybrid data solutions involving Dataverse and Azure.'
                    }
                }
            ],
            'Performance & Optimization': [
                {
                    id: 'dataverse-performance-tuning',
                    skill: 'Dataverse Performance Tuning',
                    description: 'Optimize Dataverse solutions for performance, including queries, plugins, and custom code.',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Awareness of performance impact of common operations.',
                        2: 'Identify basic performance bottlenecks in apps/flows.',
                        3: 'Optimize FetchXML queries; understand plugin best practices.',
                        4: 'Analyze and resolve complex performance issues; implement caching strategies.',
                        5: 'Architect high-performance Dataverse solutions for large-scale deployments.'
                    }
                }
            ]
        }
    },
    'm365-integration': {
        title: 'Microsoft 365 Integration',
        description: 'SharePoint, Teams, Outlook, and Graph API integration',
        categories: {
            'SharePoint Integration': [
                {
                    id: 'sharepoint-integration',
                    skill: 'SharePoint Integration',
                    description: 'Integrate Power Platform with SharePoint lists, libraries, and sites',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 4
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic SharePoint list connections',
                        2: 'Document libraries and metadata',
                        3: 'Complex workflows and content types',
                        4: 'Advanced patterns and performance',
                        5: 'Enterprise content management architecture'
                    }
                },
                {
                    id: 'sharepoint-framework-spfx',
                    skill: 'SharePoint Framework (SPFx)',
                    description: 'Develop custom web parts and extensions for SharePoint Online using SPFx.',
                    requirements: {
                        '365-developer': 1,
                        'senior-365': 2,
                        '365-architect': 3,
                        'technical-lead': 3,
                        'principal-architect': 3
                    },
                    certifications: ['MS-600'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of SharePoint extensibility.',
                        2: 'Develop simple SPFx web parts and extensions.',
                        3: 'Integrate SPFx components with Power Platform and Azure functions.',
                        4: 'Implement advanced SPFx solutions with React/Angular and PnP libraries.',
                        5: 'Architect large-scale SPFx solutions with robust deployment practices.'
                    }
                }
            ],
            'Teams Integration': [
                {
                    id: 'teams-integration',
                    skill: 'Teams Integration',
                    description: 'Embed Power Platform solutions in Microsoft Teams',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 4
                    },
                    certifications: ['MS-600'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic app embedding in Teams',
                        2: 'Teams tabs and personal apps',
                        3: 'Bots and messaging extensions',
                        4: 'Advanced Teams platform features',
                        5: 'Teams solution architecture'
                    }
                }
            ],
            'Graph API': [
                {
                    id: 'microsoft-graph-api',
                    skill: 'Microsoft Graph API',
                    description: 'Leverage Graph API for advanced Microsoft 365 integration',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['MS-600'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic Graph API concepts',
                        2: 'Simple API calls and authentication',
                        3: 'Complex queries and batch operations',
                        4: 'Advanced patterns and webhooks',
                        5: 'Enterprise Graph API architecture'
                    }
                }
            ],
            'Exchange Online & Outlook Integration': [
                {
                    id: 'exchange-online-outlook-integration',
                    skill: 'Exchange Online & Outlook Integration',
                    description: 'Develop solutions integrating with Exchange Online and Outlook for mail, calendar, and contacts.',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['MS-600'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic ability to send emails from flows/apps.',
                        2: 'Automate calendar events and contact management.',
                        3: 'Implement complex mail processing and folder automation.',
                        4: 'Utilize advanced Graph API calls for email/calendar manipulation.',
                        5: 'Architect enterprise solutions involving deep Exchange/Outlook integration.'
                    }
                }
            ]
        }
    },
    'api-development': {
        title: 'API Development',
        description: 'Custom connectors, web APIs, and integration patterns',
        categories: {
            'Custom Connectors': [
                {
                    id: 'custom-connector-development',
                    skill: 'Custom Connector Development',
                    description: 'Build custom connectors for third-party API integration',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['PL-400'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic connector concepts',
                        2: 'Simple REST API connectors',
                        3: 'OAuth authentication and pagination',
                        4: 'Advanced features and error handling',
                        5: 'Enterprise connector strategy'
                    }
                }
            ],
            'Web API Development': [
                {
                    id: 'web-api-development',
                    skill: 'Web API Development',
                    description: 'Design and implement RESTful APIs for Power Platform integration',
                    requirements: {
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 5,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic REST concepts',
                        2: 'Simple API endpoints',
                        3: 'Authentication and security',
                        4: 'API versioning and documentation',
                        5: 'Enterprise API architecture'
                    }
                }
            ],
            'Integration Patterns': [
                {
                    id: 'dataverse-web-api',
                    skill: 'Dataverse Web API',
                    description: 'Master Dataverse Web API for advanced operations and integrations',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 4,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 4
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic CRUD operations',
                        2: 'Complex queries with OData',
                        3: 'Batch operations and functions',
                        4: 'Advanced patterns and performance',
                        5: 'API governance and best practices'
                    }
                }
            ],
            'Azure API Management': [
                {
                    id: 'azure-api-management',
                    skill: 'Azure API Management',
                    description: 'Publish, secure, transform, and monitor APIs using Azure API Management.',
                    requirements: {
                        '365-developer': 1,
                        'senior-365': 2,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 5
                    },
                    certifications: ['AZ-204', 'AZ-400'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of API gateways.',
                        2: 'Publish simple APIs; configure basic policies.',
                        3: 'Implement advanced policies (e.g., caching, rate limiting, security).',
                        4: 'Design API architectures for scale and resilience; integrate with CI/CD.',
                        5: 'Lead API strategy and governance across complex enterprise landscapes.'
                    }
                }
            ]
        }
    },
    'gcp-foundations': {
        title: 'Google Cloud Platform (GCP) Foundations',
        description: 'Core concepts, services, and best practices in Google Cloud',
        categories: {
            'GCP Core Services': [
                {
                    id: 'gcp-compute-engine',
                    skill: 'Compute Engine & VM Management',
                    description: 'Provisioning, managing, and optimizing virtual machines on GCP.',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['Associate Cloud Engineer'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of VMs and instances.',
                        2: 'Create and manage simple VM instances; basic networking.',
                        3: 'Configure custom machine types, instance groups, and load balancing.',
                        4: 'Optimize VM performance and cost; implement autoscaling and health checks.',
                        5: 'Design resilient and scalable compute architectures on GCP.'
                    }
                },
                {
                    id: 'gcp-storage-solutions',
                    skill: 'Cloud Storage Solutions (GCS, BigQuery, Datastore)',
                    description: 'Utilizing various GCP storage options for different data needs.',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['Associate Cloud Engineer', 'Professional Data Engineer'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of cloud storage types.',
                        2: 'Store and retrieve data with Cloud Storage; basic BigQuery queries.',
                        3: 'Choose appropriate storage solutions (Cloud Storage, BigQuery, Cloud SQL, Datastore).',
                        4: 'Optimize storage costs and performance; implement data lifecycle policies.',
                        5: 'Architect complex data storage solutions for analytics and applications.'
                    }
                },
                {
                    id: 'gcp-networking',
                    skill: 'VPC, Load Balancing & DNS',
                    description: 'Designing and managing network infrastructure within GCP.',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['Professional Cloud Network Engineer'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of IP addresses and networks.',
                        2: 'Create VPC networks and subnets; configure firewall rules.',
                        3: 'Implement internal/external load balancers and Cloud DNS.',
                        4: 'Design complex network topologies, VPNs, and peering.',
                        5: 'Architect highly available and secure global network solutions on GCP.'
                    }
                }
            ],
            'GCP Security & Identity': [
                {
                    id: 'gcp-iam-security',
                    skill: 'IAM & Resource Hierarchy',
                    description: 'Managing access control and resource organization in GCP.',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    certifications: ['Professional Cloud Security Engineer'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of user roles.',
                        2: 'Grant and revoke IAM roles; organize resources with projects.',
                        3: 'Implement custom roles, service accounts, and folders.',
                        4: 'Design granular access controls and audit policies.',
                        5: 'Architect enterprise-wide security posture and compliance frameworks.'
                    }
                }
            ],
            'GCP Operations & Monitoring': [
                {
                    id: 'gcp-monitoring-logging',
                    skill: 'Cloud Monitoring & Logging (Operations Suite)',
                    description: 'Monitoring application performance and troubleshooting issues with GCP tools.',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 3,
                        'technical-lead': 4,
                        'principal-architect': 4
                    },
                    certifications: ['Associate Cloud Engineer'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of system logs.',
                        2: 'View logs in Cloud Logging; create basic monitoring dashboards.',
                        3: 'Configure custom metrics, alerts, and trace analysis.',
                        4: 'Implement advanced logging filters and export sinks; use Uptime Checks.',
                        5: 'Design comprehensive observability strategies for cloud-native applications.'
                    }
                }
            ]
        }
    },
    'gcp-data-ml': {
        title: 'Google Cloud Data & Machine Learning',
        description: 'Processing, analyzing, and leveraging data with GCP services.',
        categories: {
            'Data Processing': [
                {
                    id: 'gcp-dataflow-dataproc',
                    skill: 'Dataflow & Dataproc',
                    description: 'Building batch and stream data pipelines with managed services.',
                    requirements: {
                        'junior-365': 0,
                        '365-developer': 1,
                        'senior-365': 2,
                        '365-architect': 3,
                        'technical-lead': 2,
                        'principal-architect': 3
                    },
                    certifications: ['Professional Data Engineer'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of data pipelines.',
                        2: 'Run simple Dataflow jobs; use Dataproc for HDFS/Spark.',
                        3: 'Design complex ETL/ELT pipelines with Dataflow; optimize Dataproc clusters.',
                        4: 'Implement stream processing with Pub/Sub and Dataflow.',
                        5: 'Architect real-time and batch data processing solutions at scale.'
                    }
                }
            ],
            'Machine Learning': [
                {
                    id: 'gcp-vertex-ai',
                    skill: 'Vertex AI & ML Ops',
                    description: 'Building, deploying, and managing machine learning models on GCP.',
                    requirements: {
                        'junior-365': 0,
                        '365-developer': 1,
                        'senior-365': 2,
                        '365-architect': 3,
                        'technical-lead': 2,
                        'principal-architect': 3
                    },
                    certifications: ['Professional Machine Learning Engineer'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of ML concepts.',
                        2: 'Use AutoML for simple models; deploy pre-trained APIs.',
                        3: 'Train custom models with Vertex AI; manage datasets.',
                        4: 'Implement MLOps practices (versioning, pipelines, monitoring).',
                        5: 'Design and implement end-to-end ML solutions for business problems.'
                    }
                }
            ]
        }
    },
    'google-workspace': {
        title: 'Google Workspace Administration & Development',
        description: 'Managing and extending Google Workspace applications like Gmail, Drive, Docs, and Calendar.',
        categories: {
            'Workspace Administration': [
                {
                    id: 'workspace-user-management',
                    skill: 'User & Group Management (Admin Console)',
                    description: 'Managing users, groups, organizational units, and authentication settings in Google Workspace.',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 3,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['Professional Google Workspace Administrator'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic navigation of Admin console.',
                        2: 'Create/manage users and groups; basic security settings.',
                        3: 'Configure organizational units, single sign-on (SSO), and mobile device management.',
                        4: 'Implement advanced security policies; troubleshoot user access issues.',
                        5: 'Design and manage complex Google Workspace environments for large organizations.'
                    }
                },
                {
                    id: 'workspace-security-compliance',
                    skill: 'Workspace Security & Compliance',
                    description: 'Implementing security best practices, data loss prevention (DLP), and eDiscovery for Google Workspace.',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    certifications: ['Professional Google Workspace Administrator'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Awareness of basic data security.',
                        2: 'Configure basic sharing settings; understand spam controls.',
                        3: 'Implement advanced DLP rules, Vault retention policies, and audit logs.',
                        4: 'Manage security alerts; respond to eDiscovery requests; configure phishing protection.',
                        5: 'Architect comprehensive security and compliance strategies for Google Workspace.'
                    }
                }
            ],
            'Workspace Development & Automation': [
                {
                    id: 'google-apps-script',
                    skill: 'Google Apps Script',
                    description: 'Automating Google Workspace applications and integrating with external services using Apps Script.',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: [],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of scripting.',
                        2: 'Write simple scripts for Sheets/Docs automation (e.g., custom functions).',
                        3: 'Develop custom add-ons and web apps; integrate with Google APIs.',
                        4: 'Optimize script performance; implement error handling and authentication.',
                        5: 'Design and deploy complex automation solutions and integrations using Apps Script.'
                    }
                },
                {
                    id: 'workspace-apis-sdks',
                    skill: 'Google Workspace APIs & SDKs (e.g., Drive API, Calendar API)',
                    description: 'Developing applications that interact with Google Workspace services programmatically.',
                    requirements: {
                        'junior-365': 0,
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: [],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of APIs.',
                        2: 'Make simple API calls to Drive/Calendar/Gmail.',
                        3: 'Build applications that create, modify, and manage Workspace data.',
                        4: 'Handle authentication (OAuth 2.0) and error management for various APIs.',
                        5: 'Architect scalable and secure integrations with Google Workspace APIs.'
                    }
                }
            ]
        }
    },
    'governance': {
        title: 'Governance & ALM',
        description: 'Application lifecycle management, DevOps, and governance',
        categories: {
            'ALM & DevOps': [
                {
                    id: 'solution-management',
                    skill: 'Solution Management',
                    description: 'Manage solutions, dependencies, and deployment strategies',
                    requirements: {
                        '365-developer': 2,
                        'senior-365': 4,
                        '365-architect': 5,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    certifications: ['PL-400'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic solution concepts',
                        2: 'Solution packaging and deployment',
                        3: 'Managed solutions and versioning',
                        4: 'Complex ALM with dependencies',
                        5: 'Enterprise ALM strategy'
                    }
                },
                {
                    id: 'power-platform-devops',
                    skill: 'Power Platform DevOps',
                    description: 'Implement CI/CD pipelines for Power Platform solutions',
                    requirements: {
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 4
                    },
                    certifications: ['PL-400', 'AZ-400'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic version control understanding',
                        2: 'Manual deployment pipelines',
                        3: 'Automated CI/CD with Azure DevOps',
                        4: 'Advanced patterns with testing',
                        5: 'Enterprise DevOps transformation'
                    }
                }
            ],
            'Governance': [
                {
                    id: 'power-platform-coe-governance',
                    skill: 'Power Platform CoE & Governance',
                    description: 'Establish Center of Excellence and governance frameworks',
                    requirements: {
                        'senior-365': 3,
                        '365-architect': 5,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    certifications: ['PL-600'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic governance concepts',
                        2: 'DLP policies and environment management',
                        3: 'CoE toolkit implementation',
                        4: 'Advanced governance automation',
                        5: 'Enterprise governance strategy'
                    }
                }
            ],
            'Security & Compliance': [
                {
                    id: 'data-loss-prevention-dlp',
                    skill: 'Data Loss Prevention (DLP) Policies',
                    description: 'Design and implement DLP policies to prevent sensitive data leakage across Power Platform.',
                    requirements: {
                        '365-developer': 1,
                        'senior-365': 2,
                        '365-architect': 4,
                        'technical-lead': 3,
                        'principal-architect': 5
                    },
                    certifications: ['PL-600', 'MS-102'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Basic understanding of data sensitivity.',
                        2: 'Implement simple DLP policies for common connectors.',
                        3: 'Design complex DLP policies with custom data classifications.',
                        4: 'Audit and fine-tune DLP policies; integrate with compliance frameworks.',
                        5: 'Lead enterprise DLP strategy and enforcement for Power Platform.'
                    }
                },
                {
                    id: 'security-and-compliance-center',
                    skill: 'Microsoft 365 Security & Compliance Center',
                    description: 'Manage security, compliance, and privacy settings within the Microsoft 365 ecosystem.',
                    requirements: {
                        '365-developer': 1,
                        'senior-365': 2,
                        '365-architect': 3,
                        'technical-lead': 3,
                        'principal-architect': 4
                    },
                    certifications: ['SC-200', 'SC-300'],
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Awareness of basic M365 security features.',
                        2: 'Navigate the compliance center; assist with basic audits.',
                        3: 'Configure retention policies, eDiscovery, and sensitivity labels.',
                        4: 'Implement advanced compliance features; respond to data requests.',
                        5: 'Design and implement a comprehensive M365 security and compliance strategy.'
                    }
                }
            ],
            'Training & Adoption': [
                {
                    id: 'user-training-and-support',
                    skill: 'User Training & Support',
                    description: 'Develop and deliver training materials and provide ongoing support for Power Platform users.',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 3,
                        'technical-lead': 4,
                        'principal-architect': 4
                    },
                    competencyLevels: {
                        0: 'No experience',
                        1: 'Ability to answer basic user questions.',
                        2: 'Create simple user guides and FAQs.',
                        3: 'Deliver group training sessions; manage a support queue.',
                        4: 'Design comprehensive training programs; implement self-service support portals.',
                        5: 'Lead user adoption strategies and community building initiatives.'
                    }
                }
            ]
        }
    },
    'soft-skills-professional-development': {
        title: 'Soft Skills & Professional Development',
        description: 'Non-technical skills essential for effective collaboration and career growth.',
        categories: {
            'Communication & Collaboration': [
                {
                    id: 'active-listening',
                    skill: 'Active Listening',
                    description: 'Ability to fully concentrate on, understand, respond to, and remember what is being said.',
                    requirements: {
                        'junior-365': 3,
                        '365-developer': 4,
                        'senior-365': 5,
                        '365-architect': 5,
                        'technical-lead': 5,
                        'principal-architect': 5
                    },
                    competencyLevels: {
                        0: 'Rarely listens, often interrupts.',
                        1: 'Listens selectively, may miss key details.',
                        2: 'Listens to understand, but may struggle with complex or emotional conversations.',
                        3: 'Actively listens, asks clarifying questions, and provides relevant feedback.',
                        4: 'Masterful active listener, builds strong rapport and trust through listening.',
                        5: 'Coaches others on active listening, demonstrates empathy and deep understanding.'
                    }
                },
                {
                    id: 'technical-documentation',
                    skill: 'Technical Documentation & Writing',
                    description: 'Create clear, concise, and accurate documentation for technical solutions and processes.',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 4,
                        'technical-lead': 4,
                        'principal-architect': 4
                    },
                    competencyLevels: {
                        0: 'Avoids documentation; unclear writing.',
                        1: 'Produces basic notes, often incomplete.',
                        2: 'Creates functional documentation for simple tasks, may lack clarity.',
                        3: 'Produces clear, well-structured documentation for complex solutions.',
                        4: 'Develops comprehensive, user-friendly documentation and standards.',
                        5: 'Defines organizational documentation standards; mentors others in technical writing.'
                    }
                },
                {
                    id: 'presentation-skills',
                    skill: 'Presentation & Public Speaking',
                    description: 'Effectively convey complex technical information to diverse audiences.',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 5,
                        'technical-lead': 5,
                        'principal-architect': 5
                    },
                    competencyLevels: {
                        0: 'Avoids presentations; struggles with clarity.',
                        1: 'Delivers basic information; lacks engagement.',
                        2: 'Can present prepared content; some audience interaction.',
                        3: 'Delivers engaging presentations; handles questions effectively.',
                        4: 'Tailors content to audience; inspires and persuades.',
                        5: 'Masterful presenter; commands attention, influences strategy through communication.'
                    }
                }
            ],
            'Problem Solving & Critical Thinking': [
                {
                    id: 'analytical-thinking',
                    skill: 'Analytical Thinking & Problem Solving',
                    description: 'Ability to identify, analyze, and resolve complex technical and business problems.',
                    requirements: {
                        'junior-365': 3,
                        '365-developer': 4,
                        'senior-365': 5,
                        '365-architect': 5,
                        'technical-lead': 5,
                        'principal-architect': 5
                    },
                    competencyLevels: {
                        0: 'Struggles to identify root causes.',
                        1: 'Identifies obvious problems; needs guidance for solutions.',
                        2: 'Analyzes simple problems; proposes straightforward solutions.',
                        3: 'Analyzes complex problems, identifies root causes, and proposes multiple solutions.',
                        4: 'Systematically approaches problems, anticipates issues, and devises innovative solutions.',
                        5: 'Solves highly ambiguous and critical problems, sets strategic problem-solving approaches.'
                    }
                }
            ],
            'Leadership & Mentorship': [
                {
                    id: 'mentorship-and-coaching',
                    skill: 'Mentorship & Coaching',
                    description: 'Guide and develop less experienced team members.',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 2,
                        'senior-365': 4,
                        '365-architect': 4,
                        'technical-lead': 5,
                        'principal-architect': 5
                    },
                    competencyLevels: {
                        0: 'Does not engage in mentoring.',
                        1: 'Offers occasional advice; lacks structured guidance.',
                        2: 'Provides informal guidance; helps with specific tasks.',
                        3: 'Actively mentors junior colleagues; shares knowledge and best practices.',
                        4: 'Develops formal mentorship programs; coaches on career growth.',
                        5: 'Builds a culture of continuous learning and mentorship across teams.'
                    }
                }
            ],
            'Project Management Fundamentals': [
                {
                    id: 'requirements-gathering',
                    skill: 'Requirements Gathering & Analysis',
                    description: 'Elicit, document, and analyze business and technical requirements.',
                    requirements: {
                        'junior-365': 2,
                        '365-developer': 3,
                        'senior-365': 4,
                        '365-architect': 5,
                        'technical-lead': 4,
                        'principal-architect': 5
                    },
                    certifications: ['CBAP'],
                    competencyLevels: {
                        0: 'Struggles to understand project needs.',
                        1: 'Identifies basic requirements; needs help with detailed analysis.',
                        2: 'Gathers clear requirements for simple features; performs basic analysis.',
                        3: 'Elicits and documents comprehensive requirements for complex solutions; performs detailed analysis.',
                        4: 'Leads requirements workshops; identifies hidden needs and resolves conflicts.',
                        5: 'Defines organizational standards for requirements management; leads strategic discovery.'
                    }
                },
                {
                    id: 'project-planning-execution',
                    skill: 'Project Planning & Execution (Agile/Scrum)',
                    description: 'Plan, execute, and monitor projects, often using Agile methodologies.',
                    requirements: {
                        'junior-365': 1,
                        '365-developer': 2,
                        'senior-365': 3,
                        '365-architect': 4,
                        'technical-lead': 5,
                        'principal-architect': 5
                    },
                    certifications: ['PSM I', 'CSM'],
                    competencyLevels: {
                        0: 'No involvement in project planning.',
                        1: 'Understands basic project phases; follows simple tasks.',
                        2: 'Contributes to task breakdown and estimation; tracks personal progress.',
                        3: 'Plans and executes small to medium projects; participates in Agile ceremonies.',
                        4: 'Manages complex projects end-to-end; coaches agile practices.',
                        5: 'Leads multi-team programs; drives organizational adoption of project methodologies.'
                    }
                }
            ]
        }
    }
};

// Global variables to store all skill elements for efficient filtering
const allSkillElements = {}; 

function initializeAssessment() {
    document.getElementById('assessmentDate').value = new Date().toLocaleDateString('en-GB');
    renderTabs();
    renderAllSkills(); // Render all skills initially
    attachEventListeners();
    loadAssessment(); // Attempt to load saved data on startup
    updateSummary();
    updateAnalysis();
}

function renderTabs() {
    const tabsContainer = document.querySelector('.tabs');
    tabsContainer.innerHTML = ''; // Clear existing tabs

    let firstTab = true;
    for (const areaKey in skillsFramework) {
        const area = skillsFramework[areaKey];
        const tabButton = document.createElement('button');
        tabButton.classList.add('tab');
        if (firstTab) {
            tabButton.classList.add('active');
            firstTab = false;
        }
        tabButton.textContent = area.title;
        tabButton.dataset.area = areaKey;
        tabButton.onclick = () => showTab(areaKey);
        tabsContainer.appendChild(tabButton);

        const tabContent = document.createElement('div');
        tabContent.id = `${areaKey}-tab`;
        tabContent.classList.add('tab-content');
        if (tabsContainer.children.length === 1) { // First tab should be active
            tabContent.classList.add('active');
        }
        document.querySelector('.container').insertBefore(tabContent, document.getElementById('analysis-tab'));
        renderSkillsForArea(areaKey, tabContent);
    }

    // Add the "Analysis" tab as the last one
    const analysisTabButton = document.createElement('button');
    analysisTabButton.classList.add('tab');
    analysisTabButton.textContent = 'Analysis & Report';
    analysisTabButton.dataset.area = 'analysis';
    analysisTabButton.onclick = () => showTab('analysis');
    tabsContainer.appendChild(analysisTabButton);
}

function showTab(areaKey) {
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });

    document.getElementById(`${areaKey}-tab`).classList.add('active');
    document.querySelector(`.tab[data-area="${areaKey}"]`).classList.add('active');
    currentFilter = 'all'; // Reset filter when changing tabs
    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector('.filter-btn[onclick="filterSkills(\'all\')"]').classList.add('active');
    renderAllSkills(); // Re-render skills to ensure correct visibility after tab change
}

function renderSkillsForArea(areaKey, tabContentElement) {
    const area = skillsFramework[areaKey];
    tabContentElement.innerHTML = ''; // Clear previous content

    for (const categoryName in area.categories) {
        const category = area.categories[categoryName];
        const categoryDiv = document.createElement('div');
        categoryDiv.classList.add('skill-category');

        const categoryHeader = document.createElement('div');
        categoryHeader.classList.add('category-header');
        categoryHeader.innerHTML = `
            <h3 class="category-title">${categoryName}</h3>
            <p class="category-description">Skills related to ${categoryName.toLowerCase()}.</p>
        `;
        categoryDiv.appendChild(categoryHeader);

        category.forEach(skill => {
            const skillCard = createSkillCard(skill);
            categoryDiv.appendChild(skillCard);
            allSkillElements[skill.id] = skillCard; // Store reference to the skill card element
        });
        tabContentElement.appendChild(categoryDiv);
    }
}

function createSkillCard(skill) {
    const skillCard = document.createElement('div');
    skillCard.classList.add('skill-card');
    skillCard.dataset.skillId = skill.id;

    const selfRating = assessmentData[skill.id]?.self || 0;
    const managerRating = assessmentData[skill.id]?.manager || 0;

    const expectedLevel = currentRole ? (skill.requirements[currentRole] || 0) : 0;
    const careerGoalExpectedLevel = careerGoal ? (skill.requirements[careerGoal] || 0) : 0;

    const competencyDescription = skill.competencyLevels[selfRating];
    const managerCompetencyDescription = skill.competencyLevels[managerRating];

    const isRequired = currentRole && skill.requirements[currentRole] > 0;
    const isStrength = selfRating >= expectedLevel && selfRating > 0; // Considered a strength if at or above expected and rated
    const isGap = selfRating < expectedLevel && expectedLevel > 0; // Considered a gap if below expected and expected is not 0

    let gapIndicatorHtml = '';
    if (expectedLevel > 0 && selfRating !== 0) {
        if (selfRating < expectedLevel) {
            gapIndicatorHtml = `
                <div class="gap-indicator negative">
                    <span style="font-size: 1.5em;">&#x274C;</span>
                    <span class="gap-text">Gap identified: Expected L${expectedLevel}, Rated L${selfRating}</span>
                </div>
            `;
        } else if (selfRating > expectedLevel) {
            gapIndicatorHtml = `
                <div class="gap-indicator">
                    <span style="font-size: 1.5em;">&#x2705;</span>
                    <span class="gap-text">Strength: Exceeds expected L${expectedLevel}, Rated L${selfRating}</span>
                </div>
            `;
        } else {
            gapIndicatorHtml = `
                <div class="gap-indicator">
                    <span style="font-size: 1.5em;">&#x2705;</span>
                    <span class="gap-text">Meets expectations: Rated L${selfRating}</span>
                </div>
            `;
        }
    } else if (expectedLevel > 0 && selfRating === 0) {
        gapIndicatorHtml = `
            <div class="gap-indicator negative">
                <span style="font-size: 1.5em;">&#x274C;</span>
                <span class="gap-text">Not assessed, but expected at L${expectedLevel}</span>
            </div>
        `;
    }

    skillCard.innerHTML = `
        <div class="skill-header">
            <div class="skill-info">
                <div class="skill-name">${skill.skill}</div>
                <div class="skill-description">${skill.description}</div>
                <div class="skill-meta">
                    ${skill.certifications ? skill.certifications.map(cert => `<span class="meta-tag cert-tag">Cert: ${cert}</span>`).join('') : ''}
                    ${isRequired ? `<span class="meta-tag required-tag">Required for Role</span>` : ''}
                </div>
            </div>
            ${currentRole ? `<div class="expected-level-indicator">
                Expected Level (Current Role): L${expectedLevel}
            </div>` : ''}
            ${careerGoal && careerGoalExpectedLevel > 0 && careerGoal !== currentRole ? `<div class="expected-level-indicator" style="border-color: #005a9e; background: #e0f2f7; color: #005a9e;">
                Expected Level (Career Goal): L${careerGoalExpectedLevel}
            </div>` : ''}
        </div>

        <div class="assessment-grid">
            <div class="assessment-block">
                <div class="assessment-label">Your Self-Assessment</div>
                <div class="level-selector" id="self-rating-${skill.id}">
                    ${[0, 1, 2, 3, 4, 5].map(level => `
                        <button class="level-btn ${selfRating === level ? 'active' : ''} ${expectedLevel === level && expectedLevel !== 0 ? 'expected' : ''}" 
                                onclick="updateAssessment('${skill.id}', 'self', ${level})">
                            ${level}
                        </button>
                    `).join('')}
                </div>
                <div class="competency-description" id="self-description-${skill.id}">
                    ${competencyDescription || 'Select a level to see competency description.'}
                </div>
            </div>
            <div class="assessment-block">
                <div class="assessment-label">Manager Assessment</div>
                <div class="level-selector" id="manager-rating-${skill.id}">
                    ${[0, 1, 2, 3, 4, 5].map(level => `
                        <button class="level-btn ${managerRating === level ? 'active' : ''} ${expectedLevel === level && expectedLevel !== 0 ? 'expected' : ''}" 
                                onclick="updateAssessment('${skill.id}', 'manager', ${level})">
                            ${level}
                        </button>
                    `).join('')}
                </div>
                <div class="competency-description" id="manager-description-${skill.id}">
                    ${managerCompetencyDescription || 'Select a level to see competency description.'}
                </div>
            </div>
            ${gapIndicatorHtml}
        </div>
        <div class="notes-section">
            <div class="notes-grid">
                <div class="note-block">
                    <label class="note-label">Your Notes</label>
                    <textarea class="note-textarea" placeholder="Add your comments, examples, or training needs..." 
                            onkeyup="updateNote('${skill.id}', 'employee', this.value)">${skillNotes[skill.id]?.employee || ''}</textarea>
                </div>
                <div class="note-block">
                    <label class="note-label">Manager Notes</label>
                    <textarea class="note-textarea" placeholder="Manager's feedback..." 
                            onkeyup="updateNote('${skill.id}', 'manager', this.value)">${skillNotes[skill.id]?.manager || ''}</textarea>
                </div>
            </div>
        </div>
    `;
    return skillCard;
}

function renderSpecificSkillCard(skillId) {
    const skillElement = allSkillElements[skillId];
    if (skillElement) {
        // Find the original skill object from the framework
        let skillData = null;
        for (const areaKey in skillsFramework) {
            const area = skillsFramework[areaKey];
            for (const categoryName in area.categories) {
                const category = area.categories[categoryName];
                skillData = category.find(s => s.id === skillId);
                if (skillData) break;
            }
            if (skillData) break;
        }

        if (skillData) {
            const updatedCard = createSkillCard(skillData);
            skillElement.replaceWith(updatedCard);
            allSkillElements[skillId] = updatedCard; // Update reference
        }
    }
}

function renderAllSkills() {
    for (const areaKey in skillsFramework) {
        const area = skillsFramework[areaKey];
        for (const categoryName in area.categories) {
            const category = area.categories[categoryName];
            category.forEach(skill => {
                const skillCard = allSkillElements[skill.id];
                if (skillCard) {
                    let shouldShow = true;
                    const selfRating = assessmentData[skill.id]?.self || 0;
                    const expectedLevel = currentRole ? (skill.requirements[currentRole] || 0) : 0;

                    if (currentFilter === 'required') {
                        shouldShow = expectedLevel > 0;
                    } else if (currentFilter === 'gaps') {
                        shouldShow = (expectedLevel > 0 && selfRating < expectedLevel);
                    } else if (currentFilter === 'strengths') {
                        shouldShow = (selfRating > 0 && selfRating >= expectedLevel); // At or above expected, and rated
                    } else if (currentFilter === 'unassessed') {
                        shouldShow = selfRating === 0;
                    }
                    skillCard.style.display = shouldShow ? 'block' : 'none';
                }
            });
        }
    }
}


function attachEventListeners() {
    document.getElementById('currentRole').addEventListener('change', (event) => {
        currentRole = event.target.value;
        displayRoleExpectations();
        updateSummary();
        updateAnalysis();
        renderAllSkills(); // Re-render to update 'Required for Role' tags and expected levels
    });

    document.getElementById('careerGoal').addEventListener('change', (event) => {
        careerGoal = event.target.value;
        updateSummary();
        updateAnalysis();
        renderAllSkills(); // Re-render to update 'Expected Level (Career Goal)' tags
    });
}

function displayRoleExpectations() {
    const roleAlert = document.getElementById('roleAlert');
    const roleExpectationsDiv = document.getElementById('roleExpectations');
    roleExpectationsDiv.innerHTML = ''; // Clear previous expectations

    if (currentRole && roleExpectations[currentRole]) {
        roleExpectations[currentRole].forEach(expectation => {
            const item = document.createElement('div');
            item.classList.add('expectation-item');
            item.textContent = expectation;
            roleExpectationsDiv.appendChild(item);
        });
        roleAlert.classList.add('active');
    } else {
        roleAlert.classList.remove('active');
    }
}

function updateSummary() {
    let totalSkills = 0;
    let totalSelfRating = 0;
    let totalManagerRating = 0;
    let assessedSkillsCount = 0;
    let developmentAreasCount = 0;
    let strengthsCount = 0;
    let roleReadinessScore = 0;
    let requiredSkillsCount = 0;
    let achievedRequiredSkills = 0;

    for (const areaKey in skillsFramework) {
        const area = skillsFramework[areaKey];
        for (const categoryName in area.categories) {
            const category = area.categories[categoryName];
            category.forEach(skill => {
                totalSkills++;
                const selfRating = assessmentData[skill.id]?.self || 0;
                const managerRating = assessmentData[skill.id]?.manager || 0;
                const expectedLevel = currentRole ? (skill.requirements[currentRole] || 0) : 0;

                if (selfRating !== 0) {
                    assessedSkillsCount++;
                    totalSelfRating += selfRating;
                }
                if (managerRating !== 0) {
                    totalManagerRating += managerRating;
                }

                if (expectedLevel > 0) {
                    requiredSkillsCount++;
                    if (selfRating < expectedLevel && selfRating !== 0) { // Gap identified if below expected and assessed
                        developmentAreasCount++;
                    } else if (selfRating >= expectedLevel && selfRating !== 0) { // Strength if at or above expected and assessed
                        strengthsCount++;
                        achievedRequiredSkills++;
                    } else if (selfRating === 0) { // If required but not assessed, it's also a development area
                        developmentAreasCount++;
                    }
                }
            });
        }
    }

    document.getElementById('totalSkills').textContent = totalSkills;
    document.getElementById('avgSelfRating').textContent = assessedSkillsCount > 0 ? (totalSelfRating / assessedSkillsCount).toFixed(1) : '0.0';
    document.getElementById('avgManagerRating').textContent = assessedSkillsCount > 0 ? (totalManagerRating / assessedSkillsCount).toFixed(1) : '0.0';
    document.getElementById('developmentAreas').textContent = developmentAreasCount;
    document.getElementById('strengths').textContent = strengthsCount;

    if (requiredSkillsCount > 0) {
        roleReadinessScore = (achievedRequiredSkills / requiredSkillsCount) * 100;
    }
    document.getElementById('readiness').textContent = `${roleReadinessScore.toFixed(0)}%`;
}

function updateAnalysis() {
    const gapAnalysisDiv = document.getElementById('gapAnalysis');
    const strengthsAnalysisDiv = document.getElementById('strengthsAnalysis');
    const developmentRoadmapDiv = document.getElementById('developmentRoadmap');

    gapAnalysisDiv.innerHTML = '';
    strengthsAnalysisDiv.innerHTML = '';
    developmentRoadmapDiv.innerHTML = '';

    const gaps = [];
    const strengths = [];
    const roadmapSuggestions = [];

    if (!currentRole) {
        gapAnalysisDiv.textContent = 'Please select your current role to see detailed gap analysis.';
        strengthsAnalysisDiv.textContent = 'Your key strengths will appear here after assessment.';
        developmentRoadmapDiv.textContent = 'Set your current and career goal roles to see your personalized development path.';
        return;
    }

    for (const areaKey in skillsFramework) {
        const area = skillsFramework[areaKey];
        for (const categoryName in area.categories) {
            const category = area.categories[categoryName];
            category.forEach(skill => {
                const selfRating = assessmentData[skill.id]?.self || 0;
                const expectedLevel = skill.requirements[currentRole] || 0;
                const careerGoalLevel = careerGoal ? (skill.requirements[careerGoal] || 0) : 0;


                if (expectedLevel > 0 && selfRating < expectedLevel) {
                    gaps.push({ skill: skill.skill, current: selfRating, expected: expectedLevel, description: skill.competencyLevels[selfRating] });
                } else if (selfRating >= expectedLevel && selfRating > 0) { // Only count as strength if self-rated and at or above current role's expectation
                    strengths.push({ skill: skill.skill, current: selfRating, description: skill.competencyLevels[selfRating] });
                }

                // Development roadmap logic
                if (careerGoal && careerGoalLevel > 0 && selfRating < careerGoalLevel) {
                    roadmapSuggestions.push({
                        skill: skill.skill,
                        current: selfRating,
                        target: careerGoalLevel,
                        suggestion: `Improve from L${selfRating} to L${careerGoalLevel} by focusing on: ${skill.competencyLevels[careerGoalLevel]}. Consider certifications like: ${skill.certifications ? skill.certifications.join(', ') : 'N/A'}.`
                    });
                }
            });
        }
    }

    if (gaps.length > 0) {
        gapAnalysisDiv.innerHTML = '<h4>Areas to focus on for your current role:</h4><ul>' +
            gaps.map(g => `<li><strong>${g.skill}</strong>: Your rating L${g.current} (Expected L${g.expected}). Current competency: ${g.description}.</li>`).join('') +
            '</ul>';
    } else {
        gapAnalysisDiv.textContent = 'Great job! You meet or exceed expectations in all required skills for your current role. Consider setting a career goal for further development.';
    }

    if (strengths.length > 0) {
        strengthsAnalysisDiv.innerHTML = '<h4>Your current core strengths:</h4><ul>' +
            strengths.map(s => `<li><strong>${s.skill}</strong>: Rated L${s.current}. You are proficient in: ${s.description}.</li>`).join('') +
            '</ul>';
    } else {
        strengthsAnalysisDiv.textContent = 'Complete more assessments to identify your strengths.';
    }

    if (roadmapSuggestions.length > 0) {
        developmentRoadmapDiv.innerHTML = `<h4>Development path for your career goal (${document.getElementById('careerGoal').options[document.getElementById('careerGoal').selectedIndex].text}):</h4><ul>` +
            roadmapSuggestions.map(s => `<li><strong>${s.skill}</strong>: ${s.suggestion}</li>`).join('') +
            '</ul>';
    } else if (careerGoal) {
        developmentRoadmapDiv.textContent = `You currently meet or exceed the requirements for your chosen career goal (${document.getElementById('careerGoal').options[document.getElementById('careerGoal').selectedIndex].text}). Consider an even more ambitious goal!`;
    } else {
        developmentRoadmapDiv.textContent = 'Set your career goal to see your personalized development path.';
    }
}


function saveAssessment() {
    const profileInfo = {
        employeeName: document.getElementById('employeeName').value,
        managerName: document.getElementById('managerName').value,
        currentRole: document.getElementById('currentRole').value,
        department: document.getElementById('department').value,
        assessmentDate: document.getElementById('assessmentDate').value,
        careerGoal: document.getElementById('careerGoal').value,
    };

    const savedData = {
        profileInfo,
        assessmentData,
        skillNotes
    };

    localStorage.setItem('m365GoogleSkillsAssessment', JSON.stringify(savedData));
    alert('Assessment saved successfully!');
}

function loadAssessment() {
    const savedData = localStorage.getItem('m365GoogleSkillsAssessment');
    if (savedData) {
        const data = JSON.parse(savedData);

        // Load profile info
        document.getElementById('employeeName').value = data.profileInfo.employeeName || '';
        document.getElementById('managerName').value = data.profileInfo.managerName || '';
        document.getElementById('currentRole').value = data.profileInfo.currentRole || '';
        document.getElementById('department').value = data.profileInfo.department || '';
        document.getElementById('assessmentDate').value = data.profileInfo.assessmentDate || new Date().toLocaleDateString('en-GB');
        document.getElementById('careerGoal').value = data.profileInfo.careerGoal || '';

        // Update global variables for roles
        currentRole = data.profileInfo.currentRole || '';
        careerGoal = data.profileInfo.careerGoal || '';

        // Load assessment data and notes
        assessmentData = data.assessmentData || {};
        skillNotes = data.skillNotes || {};

        // Re-render all skill cards to reflect loaded data
        for (const skillId in allSkillElements) {
            renderSpecificSkillCard(skillId);
        }
        displayRoleExpectations();
        updateSummary();
        updateAnalysis();
        alert('Previous assessment loaded successfully!');
    } else {
        alert('No previous assessment found.');
    }
}

function generateDetailedReport() {
    let reportContent = `
        <h1>Microsoft 365 & Google Stack Skills Assessment Report</h1>
        <hr>
        <h2>Profile Information</h2>
        <p><strong>Your Name:</strong> ${document.getElementById('employeeName').value}</p>
        <p><strong>Manager Name:</strong> ${document.getElementById('managerName').value}</p>
        <p><strong>Current Role:</strong> ${document.getElementById('currentRole').options[document.getElementById('currentRole').selectedIndex].text}</p>
        <p><strong>Department:</strong> ${document.getElementById('department').value}</p>
        <p><strong>Assessment Date:</strong> ${document.getElementById('assessmentDate').value}</p>
        <p><strong>Career Goal:</strong> ${document.getElementById('careerGoal').options[document.getElementById('careerGoal').selectedIndex].text}</p>
        <hr>
        <h2>Assessment Summary</h2>
        <p><strong>Total Skills Assessed:</strong> ${document.getElementById('totalSkills').textContent}</p>
        <p><strong>Average Self Rating:</strong> ${document.getElementById('avgSelfRating').textContent}</p>
        <p><strong>Average Manager Rating:</strong> ${document.getElementById('avgManagerRating').textContent}</p>
        <p><strong>Development Areas:</strong> ${document.getElementById('developmentAreas').textContent}</p>
        <p><strong>Key Strengths:</strong> ${document.getElementById('strengths').textContent}</p>
        <p><strong>Role Readiness:</strong> ${document.getElementById('readiness').textContent}</p>
        <hr>
        <h2>Detailed Skill Breakdown</h2>
    `;

    for (const areaKey in skillsFramework) {
        const area = skillsFramework[areaKey];
        reportContent += `<h3>${area.title}</h3>`;
        for (const categoryName in area.categories) {
            const category = area.categories[categoryName];
            reportContent += `<h4>${categoryName}</h4><ul>`;
            category.forEach(skill => {
                const selfRating = assessmentData[skill.id]?.self || 0;
                const managerRating = assessmentData[skill.id]?.manager || 0;
                const expectedLevel = currentRole ? (skill.requirements[currentRole] || 0) : 0;
                const careerGoalLevel = careerGoal ? (skill.requirements[careerGoal] || 0) : 0;

                reportContent += `
                    <li>
                        <strong>${skill.skill}</strong>: 
                        <ul>
                            <li><strong>Your Rating:</strong> L${selfRating} - ${skill.competencyLevels[selfRating]}</li>
                            <li><strong>Manager Rating:</strong> L${managerRating} - ${skill.competencyLevels[managerRating]}</li>
                            <li><strong>Expected (Current Role):</strong> L${expectedLevel}</li>
                            ${careerGoalLevel > 0 && careerGoal !== currentRole ? `<li><strong>Expected (Career Goal):</strong> L${careerGoalLevel}</li>` : ''}
                            <li><strong>Your Notes:</strong> ${skillNotes[skill.id]?.employee || 'N/A'}</li>
                            <li><strong>Manager Notes:</strong> ${skillNotes[skill.id]?.manager || 'N/A'}</li>
                        </ul>
                    </li>
                `;
            });
            reportContent += `</ul>`;
        }
    }
    
    reportContent += `<hr><h2>Analysis & Development Roadmap</h2>`;
    reportContent += `<div style="margin-bottom: 20px;">${document.getElementById('gapAnalysis').innerHTML}</div>`;
    reportContent += `<div style="margin-bottom: 20px;">${document.getElementById('strengthsAnalysis').innerHTML}</div>`;
    reportContent += `<div style="margin-bottom: 20px;">${document.getElementById('developmentRoadmap').innerHTML}</div>`;


    const newWindow = window.open('', '_blank');
    newWindow.document.write('<html><head><title>Skills Assessment Report</title>');
    newWindow.document.write('<style>');
    newWindow.document.write(`
        body { font-family: 'Segoe UI', sans-serif; margin: 20px; color: #333; }
        h1 { color: #0078d4; text-align: center; }
        h2 { color: #005a9e; margin-top: 25px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        h3 { color: #40e0d0; margin-top: 20px; }
        h4 { color: #1976d2; margin-top: 15px; }
        ul { list-style-type: disc; margin-left: 20px; }
        li { margin-bottom: 5px; }
        strong { color: #0078d4; }
        hr { border: 0; border-top: 1px solid #eee; margin: 20px 0; }
        .gap-indicator, .gap-indicator.negative { padding: 10px; border-radius: 5px; margin-top: 10px; display: flex; align-items: center; gap: 10px; }
        .gap-indicator { background-color: #e8f5e9; border-left: 4px solid #4caf50; }
        .gap-indicator.negative { background-color: #ffebee; border-left: 4px solid #f44336; }
        .gap-text { font-weight: 600; }
        .gap-indicator .gap-text { color: #2e7d32; }
        .gap-indicator.negative .gap-text { color: #c62828; }
    `);
    newWindow.document.write('</style></head><body>');
    newWindow.document.write(reportContent);
    newWindow.document.write('</body></html>');
    newWindow.document.close();
}

function exportToPDF() {
    // Requires a library like html2canvas and jspdf
    // For simplicity, this implementation will prompt the user to print to PDF.
    alert("Please use your browser's print functionality (Ctrl/Cmd + P) and select 'Save as PDF' for a detailed report.");
    generateDetailedReport(); // Open the detailed report in a new window first
}


// Initialize the assessment when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', initializeAssessment);

    </script>
</body>
</html>
